
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Streamflow Model Evaluation &#8212; HyTEST Project</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Streamflow Eval :: Data Preparation" href="01_Data_Prep.html" />
    <link rel="prev" title="Standard Suite (v1) Metrics – Usage Examples" href="../stats/Usage_StdSuite_v1.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">HyTEST Project</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../README.html">
                    HyTEST
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Environment Set-Up
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../environment_set_up/README.html">
   Compute Environments
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../environment_set_up/QuickStart-Cloud-Nebari.html">
     Quick-Start for Nebari Cloud Environment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../environment_set_up/QuickStart-Cloud-pangeoCHS.html">
     Quick-Start for pangeo.chs.usgs.gov Cloud Environment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../environment_set_up/OpenOnDemand.html">
     HPC Server: Open OnDemand
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../environment_set_up/clusters.html">
   Starting a Dask Cluster
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../environment_set_up/Help_AWS_Credentials.html">
     AWS Credentials
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../environment_set_up/Start_Dask_Cluster_Nebari.html">
     Dask cluster on nebari.esipfed.org
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../environment_set_up/Start_Dask_Cluster_Denali.html">
     Dask Cluster on Denali HPC
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  CONUS DEMOS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../dataset_access/conus404_explore.html">
   Explore Cloud-Optimized CONUS404 Dataset
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Model Evaluation Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../metrics.html">
   Evaluation Metrics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Metrics_DScore_Suite_v1.html">
     D-Score Suite (v1) Benchmark
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../stats/Usage_DScore_Suite_v1.html">
     D-Score Suite (v1) Benchmark – Example Usage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Metrics_StdSuite_v1.html">
     Standard Suite (v1) Metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../stats/Usage_StdSuite_v1.html">
     Standard Suite (v1) Metrics – Usage Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="current reference internal" href="#">
   Streamflow Model Evaluation
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="01_Data_Prep.html">
     Streamflow Eval :: Data Preparation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_Analysis_StdSuite.html">
     Streamflow Eval :: StdSuite Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_Analysis_DScore.html">
     Essential Benchmark Components
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_Vizualization.html">
     Streamflow Eval :: Visualization
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/model_evaluation/tutorials/nwm_streamflow/00_Overview.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#source-data">
   Source Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preparation-notebook">
   <span class="xref myst">
    Data Preparation Notebook
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-notebook">
   <span class="xref myst">
    Analysis Notebook
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vizualization-notebook">
   <span class="xref myst">
    Vizualization Notebook
   </span>
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Streamflow Model Evaluation</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#source-data">
   Source Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preparation-notebook">
   <span class="xref myst">
    Data Preparation Notebook
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-notebook">
   <span class="xref myst">
    Analysis Notebook
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vizualization-notebook">
   <span class="xref myst">
    Vizualization Notebook
   </span>
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="streamflow-model-evaluation">
<h1>Streamflow Model Evaluation<a class="headerlink" href="#streamflow-model-evaluation" title="Permalink to this headline">#</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">#</a></h2>
<p>In broad strokes, the evaluation workflow contains these components:</p>
<a class="reference internal image-reference" href="../../../_images/Eval_Overview.svg"><img alt="../../../_images/Eval_Overview.svg" src="../../../_images/Eval_Overview.svg" width="600" /></a>
<p>This can be broken down per variable, as there are different reference
datasets for variables, as well as aggregation methods.  Examples below will
emphasize <em>streamflow</em> as an example, comparing historical stream gage readings against the
NWM streamflow predictions for those gages.</p>
<p>Each of the yellow boxes in the block diagram is mapped to a notebook in
which that bit of processing takes place.</p>
</div>
<div class="section" id="source-data">
<h2>Source Data<a class="headerlink" href="#source-data" title="Permalink to this headline">#</a></h2>
<p>Source datasets include modeled data
( <em><a class="reference external" href="https://registry.opendata.aws/nwm-archive/">NWM</a></em> or <em>NHM</em>, for example)
and a reference dataset representing the ‘<em>observed</em>’ values covering the
same variable and temporal range.
For <em>streamflow</em> data, we have actual gage readings.  For other variables, we have other standard
datasets representing the reference against which the model will be compared.</p>
<p>Source datasets are found in a variety of storage mechanisms.  The main mechanisms that we
need to be able to accomodate are:</p>
<ul class="simple">
<li><p>‘<em>on-prem</em>’ data stored on <code class="docutils literal notranslate"><span class="pre">/caldera</span></code>, accessible by one of the HPC hosts.</p></li>
<li><p>Object storage in the ‘<em>cloud</em>’ – typically an <span class="xref myst">S3 bucket</span> in the AWS cloud computing ecosystem.</p></li>
<li><p><span class="xref myst">API request</span> – Data is offered by a provider as a network service.  An <strong>A</strong>plication
<strong>P</strong>rogramming <strong>I</strong>nterface call is made from within a python
program to fetch the data from the network provider. This is typically via
<em>http</em> or <em>ftp</em> transfer protocols.</p></li>
<li><p><a class="reference external" href="https://pypi.org/project/intake/">Intake</a> catalog – this is a convenience mechanism which can handle
much of the infrastructure needed to access data, regardless of protocol. We use intake catalogs whenever
possible, since they simplify the access mechanism and hid implementation details.</p></li>
</ul>
<p>The source datasets may be replecated among two or more of these access methods.  Which copy to
use may depend on where the processing takes place (i.e. if running a notebook on <code class="docutils literal notranslate"><span class="pre">denali</span></code> or
<code class="docutils literal notranslate"><span class="pre">tallgrass</span></code>, <em>on-prem</em> data is preferred over S3;  if running on a cloud environment (esip/qhub),
S3 is preferred.)</p>
</div>
<div class="section" id="data-preparation-notebook">
<h2><a class="reference internal" href="01_Data_Prep.html"><span class="doc std std-doc">Data Preparation Notebook</span></a><a class="headerlink" href="#data-preparation-notebook" title="Permalink to this headline">#</a></h2>
<p>This pre-processing step is needed in order to rectify the data and organize it in preparation
for analysis.  Rectifying the data includes measures such as:</p>
<ul class="simple">
<li><p>Organizing the time-series index such that the time steps for both <em>simulated</em> and <em>observed</em> are congruent;</p></li>
<li><p>Coordinate aggregation units between <em>simulated</em> and <em>observed</em> (e.g. indexed on ‘<em>gage_id</em>’ with similar string formats: ‘USGS-01104200’ vs ‘01104200’)</p></li>
<li><p>Re-Chunking the data to make time-series analysis more efficient</p></li>
<li><p>Obtaining data from an API and storing it in more efficient format for reuse</p></li>
</ul>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>See <span class="xref myst">here</span> for a primer on re-chunking data, and why we choose to do it before analysis.</p>
</div>
<p>At this stage, a given variable should be represented as a pair of 2D array of values (one
for <em>simulated</em>, one for <em>observed</em>).
One dimension of the array is indexed by some nominal key (‘<em>gage_id</em>’, ‘<em>HUC-12</em> ID’,
etc), while the other dimension is indexed by time step.</p>
</div>
<div class="section" id="analysis-notebook">
<h2><a class="reference internal" href="02_Analysis_StdSuite.html"><span class="doc std std-doc">Analysis Notebook</span></a><a class="headerlink" href="#analysis-notebook" title="Permalink to this headline">#</a></h2>
<p>The above data organization steps will allow us to extract a time series for a given station
from each of the <em>simulated</em> and <em>observed</em> datasets, and run a series of statistical metrics
against these values to evaluate Goodness Of Fit (GOF).  Benchmarking proceeds
according to this general recipe:</p>
<ol class="simple">
<li><p>A set of predictions and matching observations (i.e. the <strong>data</strong>, established above);</p></li>
<li><p>The <strong>domain</strong> (e.g. space or time) over which to benchmark</p>
<ul class="simple">
<li><p>This will vary by variable and by dataset.  For <em>streamflow</em>, the list
of ‘cobalt’ gages (<a class="reference external" href="https://doi.org/10.5066/P972P42Z">Foks et al., 2022</a>)
establishes the spatial domain identifying which gages to consider.</p></li>
<li><p>Other variables will have other definitions for domain, which restrict
analysis to a specific set of locations or times.</p></li>
</ul>
</li>
<li><p>A set of statistical <strong>metrics</strong> with which to benchmark.</p>
<ul class="simple">
<li><p>In this tutorial, we are focusing on <em>streamflow</em> and the metrics relevant to
that variable.</p></li>
<li><p>A different set of metrics may be used for other variables.</p></li>
<li><p>We will be using the ‘NWM Standard Suite’ and ‘DScore’ metrics to analyize <em>streamflow</em>.</p></li>
</ul>
</li>
</ol>
<p>The end result of this analysis is a 2D table of values.  One dimension of
this array/table is the same nominal data field (i.e. ‘<em>gage_id</em>’), the other
dimension being the metrics comparing observed vs simulated for that gage.
It is this table of values we send to the visualization step.</p>
</div>
<div class="section" id="vizualization-notebook">
<h2><a class="reference internal" href="03_Vizualization.html"><span class="doc std std-doc">Vizualization Notebook</span></a><a class="headerlink" href="#vizualization-notebook" title="Permalink to this headline">#</a></h2>
<p>Visualization steps offer different views of the metrics, plotted in various
ways to allow for exploration.  In addition to these interactive visualizations,
a score card is offered as a way of summarizing how well the
model compares against the reference dataset.</p>
</div>
<div class="toctree-wrapper compound">
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./model_evaluation/tutorials/nwm_streamflow"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../stats/Usage_StdSuite_v1.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Standard Suite (v1) Metrics – Usage Examples</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="01_Data_Prep.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Streamflow Eval :: Data Preparation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Jupyter Book community<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>